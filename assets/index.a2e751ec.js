var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,l=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&r(e,a,t[a]);return e},o=(e,s)=>t(e,a(s));import{a as c,l as p,y as m,J as u,N as d}from"./vendor.87791f12.js";function v({title:e,items:t,name:a}){return c("div",{class:`card area-${a}`},e&&c("div",{class:"card-title"},e),c("div",{class:"collection-list"},t.map((e=>c("span",{class:"card-value"},e)))))}function f({data:e,goal:t,title:a,name:s}){const i=(e.reduce(((e,t)=>e+t))/e.length).toFixed(3);return c("div",{class:`card graph area-${s}`,style:"--goal: "+1.5*t},e.map((e=>{const a=`hsl(${Math.max(0,150-100*e/t)}deg, 80%, 55%)`;return c("div",{class:"graph-value",style:`--value: ${e}; --color: ${a};`})})),a&&c("span",{class:"graph-title"},a),c("span",{class:"graph-info"},"avg: ",i))}function k({title:e,properties:t,name:a}){return c("div",{class:`card area-${a}`},e&&c("div",{class:"card-title"},e),c("div",{class:"card-properties"},t.map((e=>c("div",{class:"card-property"},c("span",{class:"card-key"},e[0],": "),c("span",{class:"card-value"},e[1]))))))}function y({name:e,columns:t,data:a}){const[s,i]=p(Math.min(100,a.length));return c("div",{class:`card table area-${e}`},c("div",{class:"table-row table-head"},t.map((e=>c("div",{class:"table-column"},e)))),c("div",{class:"table-body"},a.slice(0,s).map((e=>c("div",{class:"table-row"},e.map((e=>c("div",{class:"table-column"},e)))))),a.length>s&&c("div",{class:"table-row table-foot"},c("div",null,a.length-s," entries hidden"),a.length-s>100&&c("div",{class:"table-action",onClick:()=>i(s+100)},"Show 100 more"),c("div",{class:"table-action",onClick:()=>i(a.length)},"Show all")),0===a.length&&c("div",{class:"table-row table-foot"},c("div",null,"None"))))}function g({report:e}){return c(m,null,c(k,{name:"gamerules",properties:Object.entries(e.server.gamerules)}))}function h({report:e}){const[t,a]=p("entities");return c(m,null,c("ul",{class:"panels"},c("li",{class:"panel"+("entities"===t?" active":""),onClick:()=>a("entities")},"Entities"),c("li",{class:"panel"+("block-entities"===t?" active":""),onClick:()=>a("block-entities")},"Block entities"),c("li",{class:"panel"+("chunks"===t?" active":""),onClick:()=>a("chunks")},"Chunks")),"entities"===t&&c(y,{name:"entities",columns:["Type","Position","Dimension"],data:Object.entries(e.server.levels).flatMap((([e,t])=>t.entities.map((t=>o(l({},t),{dimension:e}))))).map((e=>[e.type.replace(/^minecraft:/,""),`${Math.round(e.x)} ${Math.round(e.y)} ${Math.round(e.z)}`,e.dimension.replace(/^minecraft:/,"")]))}),"block-entities"===t&&c(y,{name:"block-entities",columns:["Type","Position","Dimension"],data:Object.entries(e.server.levels).flatMap((([e,t])=>t.blockEntities.map((t=>o(l({},t),{dimension:e}))))).map((e=>[e.type.replace(/^minecraft:/,""),`${Math.round(e.x)} ${Math.round(e.y)} ${Math.round(e.z)}`,e.dimension.replace(/^minecraft:/,"")]))}),"chunks"===t&&c(y,{name:"chunks",columns:["Position","Dimension","Level","Status"],data:Object.entries(e.server.levels).flatMap((([e,t])=>t.chunks.map((t=>o(l({},t),{dimension:e}))))).map((e=>{var t,a,s,i;return[`${Math.round(e.x)} ${Math.round(e.z)}`,e.dimension.replace(/^minecraft:/,""),`${e.level}`,"minecraft:full"===e.status?null!=(a=null==(t=e.fullStatus)?void 0:t.toLowerCase())?a:"unknown":null!=(i=null==(s=e.status)?void 0:s.replace(/^minecraft:/,""))?i:"unknown"]}))}))}function b({report:e}){const t=e.server.stats.averageTickTime,a=Math.min(...e.server.stats.tickTimes)/1e6,s=Math.max(...e.server.stats.tickTimes)/1e6;return c(m,null,c(k,{name:"stats",title:"Server stats",properties:[["Average tick",`${t.toFixed(3)} mspt`],["Minimum tick",`${a.toFixed(3)} mspt`],["Maximum tick",`${s.toFixed(3)} mspt`]]}),c(f,{name:"tick-graph",title:"Server tick (mspt)",goal:50,data:e.server.stats.tickTimes.map((e=>Math.round(e/1e6)))}),c(f,{name:"server-metrics",title:"Full server tick",goal:50,data:e.server.metrics.ticking.map((e=>Math.round(e.tickTime/1e6)))}),c(f,{name:"client-metrics",title:"Client tick",goal:60,data:e.client.metrics.ticking.map((e=>Math.round(1e3/(e.tickTime/1e6))))}))}function w({report:e}){const[t,a]=p("server"),[s,i]=p(new Set),n=e[t].profiling,r=1e3*n.tickSpan/n.timeSpan;return c(m,null,c("ul",{class:"panels"},c("li",{class:"panel"+("server"===t?" active":""),onClick:()=>a("server")},"Server"),c("li",{class:"panel"+("client"===t?" active":""),onClick:()=>a("client")},"Client")),c(k,{name:"profiling-stats",properties:[["Time span",`${n.timeSpan} ms`],["Tick span",`${n.tickSpan} ticks`],["Average tick",`${r.toFixed(3)} mspt`]]}),c("div",{class:"card profile area-profile-dump"},c($,{children:n.dump,hidden:s,path:"root",level:0,tickTime:r,onToggle:e=>{s.has(e)?s.delete(e):s.add(e),i(new Set(s))}})))}function $({children:e,hidden:t,path:a,level:s,tickTime:i,onToggle:n}){return c(m,null,Object.entries(e).map((([e,r])=>{const l=`${a}.${e}`;return c(m,null,c("div",{class:`profile-entry level-${s}`,onClick:r.children&&(()=>n(l))},c("div",{class:"profile-name"},e.startsWith("ServerLevel[")?e.split(" ").pop():e),void 0!==r.ofTotal&&c("div",{class:"profile-parts"},c("span",null,r.ofParent," % / "),r.ofTotal," %"),void 0!==r.ofTotal&&c("div",{class:"profile-times"},(i*r.ofTotal/100).toFixed(3)," ms"),c("div",{class:"profile-counts"},c("span",null,r.count," / "),r.averageCount)),r.children&&!t.has(l)&&c($,{children:r.children,hidden:t,path:l,level:s+1,tickTime:i,onToggle:n}))})))}function M({report:e}){return c(m,null,c(k,{name:"version",title:"Minecraft version",properties:[["Name",e.system.versionName],["Id",e.system.versionId],["Is modded",e.system.isModded?"Yes":"Probably not"]]}),c(k,{name:"game-options",title:"Game options",properties:[["Player count",`${e.system.playerCount.join(" / ")}`],["Language",e.system.language],["Graphics mode",e.system.graphicsMode],["Using VBOs",e.system.vbos?"Yes":"No"]]}),c(k,{name:"software",title:"Software",properties:[["Operating system",e.system.operatingSystem],["Java version",e.system.javaVersion],["Java VM",e.system.jvmVersion],["Library",e.system.library]]}),c(k,{name:"hardware",title:"Hardware",properties:[["Processor",e.system.processorName],["CPUs",`${e.system.cpus}`],["Frequency",`${e.system.frequency} GHz`],["Graphics card",e.system.graphicsCardName]]}),c(v,{name:"data-packs",title:"Data packs",items:e.system.dataPacks}),c(v,{name:"resource-packs",title:"Resource packs",items:e.system.resourcePacks}))}const x={x:c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},c("path",{"fill-rule":"evenodd",d:"M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"}))};var T;!function(e){async function t(e,t){var a,s;const n=await i(e,t),r=n.indexOf("--- BEGIN PROFILE DUMP ---")+2,o=n.indexOf("--- END PROFILE DUMP ---"),c=[],p=[];let m=-1;for(let i=r;i<o;i+=1){const e=n[i].match(/^\[(\d\d)\][ |]+(.*)(\((\d+)\/(\d+)\) - ([\d\.]+)%\/([\d\.]+)%| (\d+)\/(\d+))$/),t=parseInt(e[1]),r=e[2];t>m?c.push({}):p.pop();for(let a=0;a<m-t;a+=1){const e=c.pop();c[c.length-1][p.pop()].children=e}p.push(r),m=t,c[c.length-1][r]=l({count:parseInt(null!=(a=e[4])?a:e[8]),averageCount:parseInt(null!=(s=e[5])?s:e[9])},e[6]&&{ofParent:parseFloat(e[6]),ofTotal:parseFloat(e[7])})}return{timeSpan:parseInt(n[4].split(":")[1]),tickSpan:parseInt(n[5].split(":")[1]),dump:c[0]}}async function a(e,t){const[a,...s]=await i(e,t),n=a.split(",").map((e=>e.trim()));return s.map((e=>Object.fromEntries(e.split(",").map(((e,t)=>[n[t],e.trim()])))))}async function s(e,t,a=":"){const s=await i(e,t);return Object.fromEntries(s.filter((e=>e.includes(a))).map((e=>{const[t,...s]=e.split(a);return[t,s.join(a).trim()]})))}async function i(e,t){const a=e.files[t];if(!a)throw new Error(`Cannot find "${t}"`);return(await a.async("text")).trimEnd().split("\n")}(T||(T={})).fromZip=async function(e){const i=await e.arrayBuffer(),n=await u.loadAsync(i),r=await a(n,"client/metrics/ticking.csv"),l=await s(n,"client/options.txt"),o=await t(n,"client/profiling.txt"),c=await a(n,"server/metrics/ticking.csv"),p=await t(n,"server/profiling.txt"),m=await s(n,"server/gamerules.txt","="),d=await s(n,"server/stats.txt"),v=await s(n,"system.txt"),f=Object.keys(n.files).filter((e=>e.match(/^server\/levels\/[a-z0-9_-]+\/[a-z0-9_-]+\/$/))),k=await Promise.all(f.map((e=>async function(e,t){const i=await a(e,`${t}block_entities.csv`),n=await a(e,`${t}chunks.csv`),r=await a(e,`${t}entities.csv`),l=await a(e,`${t}entity_chunks.csv`),o=await s(e,`${t}stats.txt`),c=o.entities.split(",").map((e=>parseInt(e)));return{blockEntities:i.map((e=>({x:parseFloat(e.x),y:parseFloat(e.y),z:parseFloat(e.z),type:e.type}))),chunks:n.map((e=>({x:parseInt(e.x),z:parseInt(e.z),level:parseInt(e.level),inMemory:"true"===e.in_memory,status:"[null]"===e.status?null:e.status,fullStatus:"[null]"===e.full_status?null:e.full_status,accessibleReady:e.accessible_ready,tickingReady:e.ticking_ready,entityTickingReady:e.entity_ticking_ready,spawning:"true"===e.spawning,blockEntityCount:parseInt(e.block_entity_count)}))),entities:r.map((e=>({x:parseFloat(e.x),y:parseFloat(e.y),z:parseFloat(e.z),uuid:e.uuid,type:e.type,alive:"true"===e.alive,displayName:e.display_name,customName:"[null]"===e.custom_name?null:e.custom_name}))),entityChunks:l.map((e=>({x:parseFloat(e.x),y:parseFloat(e.y),z:parseFloat(e.z),visibility:e.visibility,loadStatus:e.load_status,entityCount:parseInt(e.entity_count)}))),stats:{spawningChunks:parseInt(o.spawning_chunks),entities:{knownUuids:c[0],visibleEntityStorage:c[1],sectionStorage:c[2],chunkLoadStatuses:c[3],chunkVisibility:c[4],loadingInbox:c[5],chunksToUnload:c[6]},blockEntityTickers:parseInt(o.block_entity_tickers),blockTicks:parseInt(o.block_ticks),fluidTicks:parseInt(o.fluid_ticks),pendingTasks:parseInt(o.pending_tasks)}}}(n,e))));return{name:e.name,client:{metrics:{ticking:r.map((e=>({tick:parseInt(e["@tick"]),tickTime:Number(e.ticktime)})))},options:l,profiling:o},server:{levels:Object.fromEntries(f.map(((e,t)=>[e.replace(/^server\/levels\/([a-z0-9_-]+)\/([a-z0-9_-]+)\/$/,"$1:$2"),k[t]]))),metrics:{ticking:c.map((e=>({tick:parseInt(e["@tick"]),tickTime:Number(e.ticktime)})))},gamerules:m,profiling:p,stats:{pendingTasks:parseInt(d.pending_tasks),averageTickTime:parseFloat(d.average_tick_time),tickTimes:JSON.parse(d.tick_times)}},system:{versionName:v["Minecraft Version"],versionId:v["Minecraft Version ID"],isModded:!v["Is Modded"].startsWith("Probably not."),resourcePacks:v["Resource Packs"].split(",").map((e=>e.trim())),dataPacks:v["Data Packs"].split(",").map((e=>e.trim())),operatingSystem:v["Operating System"],javaVersion:v["Java Version"],jvmVersion:v["Java VM Version"],library:v["Backend library"],processorName:v["Processor Name"],cpus:parseInt(v.CPUs),frequency:parseFloat(v["Frequency (GHz)"]),graphicsCardName:v["Graphics card #0 name"],playerCount:v["Player Count"].split(";")[0].split(" / ").map((e=>parseInt(e))),language:v["Current Language"],graphicsMode:v["Graphics mode"],vbos:"Yes"===v["Using VBOs"]}}}}();const I=["Overview","System","Gamerules","Levels","Profiling"];function P(){const[e,t]=p([]),[a,s]=p(0),[i,n]=p("Overview"),r=e[Math.min(e.length-1,a)];return c("main",{onDrop:async a=>{if(a.preventDefault(),!a.dataTransfer)return;const i=[];let n="";for(let t=0;t<a.dataTransfer.files.length;t++){const s=a.dataTransfer.files[t];s.type.match(/^application\/(x-)?zip(-compressed)?$/)&&(e.find((e=>e.name===s.name))?n=s.name:i.push(T.fromZip(s)))}if(i.length>0){const a=await Promise.all(i);s(e.length+a.length-1),t([...e,...a])}else{const t=e.findIndex((e=>e.name===n));-1!==t&&s(t)}},onDragOver:e=>e.preventDefault()},0===e.length?c(m,null,c("div",{class:"drop"},c("h1",null,"Drop profiling report here"),c("p",null,"Singleplayer: F3 + L"),c("p",null,"Multiplayer: /perf start"),c("p",null,"Located in .minecraft/debug/profiling/"))):c(m,null,c("ul",{class:"tabs"},e.map(((i,n)=>c("li",{class:"tab"+(Math.min(e.length-1,a)===n?" active":""),onClick:()=>s(n),title:i.name},c("div",{class:"tab-name"},i.name.replace(/\.zip$/,"")),c("button",{class:"tab-remove",onClick:()=>{return a=n,void t(e.filter(((e,t)=>t!==a)));var a}},x.x))))),c("ul",{class:"panels"},I.map((e=>c("li",{class:"panel"+(i===e?" active":""),onClick:()=>n(e)},e)))),c("div",{class:"report"},"Overview"===i&&c(b,{report:r}),"System"===i&&c(M,{report:r}),"Gamerules"===i&&c(g,{report:r}),"Levels"===i&&c(h,{report:r}),"Profiling"===i&&c(w,{report:r})),c("div",{class:"footer"},c("p",null,"Developed by Misode"),c("p",null,"Source code on ",c("a",{href:"https://github.com/misode/report",target:"_blank"},"GitHub")))))}d(c(P,null),document.body);
